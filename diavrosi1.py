import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation # ÎÎ­Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®
from PIL import Image

# Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î­Ï‚ ÎµÎ´Î¬Ï†Î¿Ï…Ï‚ ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚
soil_types = {'Î†Î¼Î¼Î¿Ï‚': 2.0, 'Î Î·Î»ÏŒÏ‚': 1.0, 'Î’ÏÎ¬Ï‡Î¿Ï‚': 0.5, 'Î§Î±Î»Î¯ÎºÎ¹': 0.8}
protection_factors = {'ÎšÎ±Î¼Î¯Î±': 1.0, 'ÎšÏ…Î¼Î±Ï„Î¿Î¸ÏÎ±ÏÏƒÏ„ÎµÏ‚': 0.4, 'Î¤ÎµÏ‡Î½Î·Ï„Î® Ï€Î±ÏÎ±Î»Î¯Î±': 0.5, 'Î‘Î½Î±Ï‡ÏÎ¼Î±Ï„Î±': 0.3}

# Î•Î¹ÎºÏŒÎ½Î± Ï€Î±ÏÎ±Î»Î¯Î±Ï‚
st.image("https://upload.wikimedia.org/wikipedia/commons/8/8e/Beach_wave.jpg", caption="Î Î±ÏÎ±Î»Î¯Î± Ï…Ï€ÏŒ Î´Î¹Î¬Î²ÏÏ‰ÏƒÎ·", use_column_width=True)

st.title("ğŸŒŠ Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏŒ Î•ÏÎ³Î±Î»ÎµÎ¯Î¿: Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ· Î Î±ÏÎ±Î»Î¯Î±Ï‚")
st.markdown("**Î ÎµÎ¹ÏÎ±Î¼Î±Ï„Î¯ÏƒÎ¿Ï… Î¼Îµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Î´ÎµÏ‚ Ï€ÏÏ‚ Î· Ï€Î±ÏÎ±Î»Î¯Î± Î±Î»Î»Î¬Î¶ÎµÎ¹ Î¼Îµ Ï„Î± Ï‡ÏÏŒÎ½Î¹Î±!**")

# Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½
col1, col2 = st.columns(2)
with col1:
    ÏÏˆÎ¿Ï‚_ÎºÏÎ¼Î±Ï„Î¿Ï‚ = st.slider("ÎÏˆÎ¿Ï‚ ÎšÏÎ¼Î±Ï„Î¿Ï‚ (m)", 0.5, 5.0, 1.5, step=0.1)
    ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î± = st.slider("Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± ÎšÏ…Î¼Î¬Ï„Ï‰Î½ (ÎºÏÎ¼Î±Ï„Î±/ÏÏÎ±)", 1, 20, 5)
    Î³Ï‰Î½Î¯Î± = st.slider("Î“Ï‰Î½Î¯Î± Î ÏÏŒÏƒÏ€Ï„Ï‰ÏƒÎ·Ï‚ (Î¼Î¿Î¯ÏÎµÏ‚)", 0, 90, 45)
with col2:
    Ï„ÏÏ€Î¿Ï‚_Î±ÎºÏ„Î®Ï‚ = st.selectbox("Î¤ÏÏ€Î¿Ï‚ Î‘ÎºÏ„Î®Ï‚", list(soil_types.keys()))
    Î­ÏÎ³Î¿_Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ = st.selectbox("ÎˆÏÎ³Î¿ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚", list(protection_factors.keys()))
    Ï‡ÏÏŒÎ½Î¹Î± = st.slider("Î”Î¹Î¬ÏÎºÎµÎ¹Î± Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ·Ï‚ (Î­Ï„Î·)", 1, 50, 10)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚
K = soil_types[Ï„ÏÏ€Î¿Ï‚_Î±ÎºÏ„Î®Ï‚]
P = protection_factors[Î­ÏÎ³Î¿_Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚]
Î¸_rad = np.radians(Î³Ï‰Î½Î¯Î±)
erosion_rate = K * ÏÏˆÎ¿Ï‚_ÎºÏÎ¼Î±Ï„Î¿Ï‚ * ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î± * abs(np.sin(Î¸_rad)) * P
Î­Ï„Î· = np.arange(0, Ï‡ÏÏŒÎ½Î¹Î± + 1)
Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· = erosion_rate * Î­Ï„Î·

# Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
st.subheader("ğŸ“Š Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±:")
st.write(f"**Î¡Ï…Î¸Î¼ÏŒÏ‚ Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚**: {erosion_rate:.2f} m/Î­Ï„Î¿Ï‚")
df = pd.DataFrame({"ÎˆÏ„Î¿Ï‚": Î­Ï„Î·, "Î¥Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· Î‘ÎºÏ„Î®Ï‚ (m)": Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·})
st.dataframe(df)

# ÎšÎ±Ï„Î­Î²Î±ÏƒÎ¼Î± ÏƒÎµ CSV
csv = df.to_csv(index=False).encode('utf-8')
st.download_button("â¬‡ï¸ ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ Ï„Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± ÏƒÎµ CSV", csv, "Î´Î¹Î±Î²ÏÏ‰ÏƒÎ·.csv", "text/csv")

st.markdown("---")

## Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î¼Îµ Animation

st.subheader("â³ Î•Î¾Î­Î»Î¹Î¾Î· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î¼Îµ Ï„Î± Î§ÏÏŒÎ½Î¹Î±:")

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ Î³Î¹Î± animation
fig_anim, ax_anim = plt.subplots()
line, = ax_anim.plot([], [], marker='o', color='teal')
ax_anim.set_xlabel("ÎˆÏ„Î·")
ax_anim.set_ylabel("Î¥Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· Î‘ÎºÏ„Î®Ï‚ (m)")
ax_anim.set_title("Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î Î±ÏÎ±Î»Î¯Î±Ï‚ - Î•Î¾Î­Î»Î¹Î¾Î·")
ax_anim.grid(True)
ax_anim.set_xlim(0, Ï‡ÏÏŒÎ½Î¹Î±)
ax_anim.set_ylim(0, Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·[-1] * 1.1 if Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·[-1] > 0 else 1) # Î‘Ï…Î¾Î¬Î½Î¿Ï…Î¼Îµ Î»Î¯Î³Î¿ Ï„Î¿ y-limit Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·

# Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·Ï‚ Ï„Î¿Ï… animation
def update(frame):
    current_year = frame
    if current_year <= Ï‡ÏÏŒÎ½Î¹Î±: # Î•Î»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î½Î± Î¼Î·Î½ Î¾ÎµÏ€ÎµÏÎ¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î± Ï‡ÏÏŒÎ½Î¹Î±
        xdata = Î­Ï„Î·[:current_year + 1]
        ydata = Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·[:current_year + 1]
        line.set_data(xdata, ydata)
        ax_anim.set_title(f"Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î Î±ÏÎ±Î»Î¯Î±Ï‚ - ÎˆÏ„Î¿Ï‚: {current_year}")
    return line,

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… animation
# Î¤Î¿ interval ÎµÎ¯Î½Î±Î¹ ÏƒÎµ ms, Î¿Ï€ÏŒÏ„Îµ 200ms = 0.2 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î± Î±Î½Î¬ ÎºÎ±ÏÎ­
anim = FuncAnimation(fig_anim, update, frames=range(Ï‡ÏÏŒÎ½Î¹Î± + 1), blit=True, interval=200, repeat=False)

# Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î¿Ï… animation Ï‰Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿ MP4
# Î“Î¹Î± Î½Î± Î´Î¿Ï…Î»Î­ÏˆÎµÎ¹ Î±Ï…Ï„ÏŒ, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Ï„Î¿ ffmpeg ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±
# Î•Ï€ÎµÎ¹Î´Î® Ï„Î¿ Streamlit Cloud Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï€Î¬Î½Ï„Î± Ï€ÏÎ¿ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ Ï„Î¿ ffmpeg,
# ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ Î±ÏƒÏ†Î±Î»Î­Ï‚ Î½Î± Ï„Î¿ ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎ¿Ï…Î¼Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï‰Ï‚ Î²Î¯Î½Ï„ÎµÎ¿ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ.
try:
    # Î‘Î½ Ï„Î¿ Streamlit Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ animation rendering Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚, Î¸Î± Ï„Î¿ Î´ÎµÎ¯Î¾ÎµÎ¹.
    # Î”Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ animation ÎºÎ±Î¹ Î½Î± Ï„Î¿ Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î¼Îµ.
    # Î“Î¹Î± Î±Ï€Î»ÏŒÏ„Î·Ï„Î±, Î¸Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎ¿Ï…Î¼Îµ Î½Î± Ï„Î¿ Î´ÎµÎ¯Î¾Î¿Ï…Î¼Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î¼Î­ÏƒÏ‰ st.pyplot
    # Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¿ Î¼ÎµÏ„Î±Ï„ÏÎ­ÏˆÎµÎ¹ ÏƒÎµ GIF/MP4 Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.
    st.pyplot(fig_anim)
except Exception as e:
    st.warning(f"Î”ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€ÏÎ¿Î²Î»Î·Î¸ÎµÎ¯ Ï„Î¿ animation Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÏƒÎ±Ï‚. ({e})")
    # Î©Ï‚ fallback, Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´ÎµÎ¯Î¾Î¿Ï…Î¼Îµ Ï„Î¿ Ï„ÎµÎ»Î¹ÎºÏŒ Î³ÏÎ¬Ï†Î·Î¼Î±
    fig_final, ax_final = plt.subplots()
    ax_final.plot(Î­Ï„Î·, Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·, marker='o', color='teal')
    ax_final.set_xlabel("ÎˆÏ„Î·")
    ax_final.set_ylabel("Î¥Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· Î‘ÎºÏ„Î®Ï‚ (m)")
    ax_final.set_title("Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î Î±ÏÎ±Î»Î¯Î±Ï‚ (Î¤ÎµÎ»Î¹ÎºÏŒ Î“ÏÎ¬Ï†Î·Î¼Î±)")
    ax_final.grid(True)
    st.pyplot(fig_final)


# Î¤Î¿ Î±ÏÏ‡Î¹ÎºÏŒ ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Î³ÏÎ¬Ï†Î·Î¼Î± Î¸Î± Î¼ÎµÏ„Î±Ï†ÎµÏÎ¸ÎµÎ¯ Î¼ÎµÏ„Î¬ Ï„Î¿ animation Î® Î¸Î± Ï€Î±ÏÎ±Î»ÎµÎ¹Ï†Î¸ÎµÎ¯
# Î•Ï€ÎµÎ¹Î´Î® Î­Ï‡Î¿Ï…Î¼Îµ animation, Ï„Î¿ ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Î³ÏÎ¬Ï†Î·Î¼Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼Î·Î½ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿,
# ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î¸Î­Î»Î¿Ï…Î¼Îµ Î½Î± Î´ÎµÎ¯Î¾Î¿Ï…Î¼Îµ Ï„Î¿ Ï„ÎµÎ»Î¹ÎºÏŒ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Î¾ÎµÎºÎ¬Î¸Î±ÏÎ±.
# Î“Î¹Î± Ï„Î·Î½ ÏÏÎ±, Ï„Î¿ Î±Ï†Î®Î½Ï‰ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰, Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÏ„Îµ.

fig, ax = plt.subplots()
ax.plot(Î­Ï„Î·, Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·, marker='o', color='teal')
ax.set_xlabel("ÎˆÏ„Î·")
ax.set_ylabel("Î¥Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· Î‘ÎºÏ„Î®Ï‚ (m)")
ax.set_title("Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Î”Î¹Î¬Î²ÏÏ‰ÏƒÎ·Ï‚ Î Î±ÏÎ±Î»Î¯Î±Ï‚ (Î¤ÎµÎ»Î¹ÎºÏŒ Î“ÏÎ¬Ï†Î·Î¼Î±)") # Î‘Î»Î»Î¬Î¶Ï‰ Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ Î³Î¹Î± Î½Î± Î¾ÎµÏ‡Ï‰ÏÎ¯Î¶ÎµÎ¹
ax.grid(True)
st.pyplot(fig)


# Î•Ï€ÎµÎ¾Î®Î³Î·ÏƒÎ·
st.markdown("""
### â„¹ï¸ Î¤Î¹ Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Ï„Î¿ Î³ÏÎ¬Ï†Î·Î¼Î±;
- ÎŒÏƒÎ¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î· **Ï…Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ·**, Ï„ÏŒÏƒÎ¿ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ· Î´Î¹Î¬Î²ÏÏ‰ÏƒÎ· Î­Ï‡ÎµÎ¹ ÏƒÏ…Î¼Î²ÎµÎ¯.
- Î— **Î´Î¹Î¬Î²ÏÏ‰ÏƒÎ· ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÏ„Î±Î¹** Î±Ï€ÏŒ:
    - ÎÏˆÎ¿Ï‚ ÎºÎ±Î¹ ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î± ÎºÏÎ¼Î±Ï„Î¿Ï‚
    - Î¤ÏÏ€Î¿ ÎµÎ´Î¬Ï†Î¿Ï…Ï‚
    - Î“Ï‰Î½Î¯Î± Ï€ÏÏŒÏƒÏ€Ï„Ï‰ÏƒÎ·Ï‚
    - Î Î±ÏÎ¿Ï…ÏƒÎ¯Î± Î­ÏÎ³Ï‰Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚
""")

# Footer
st.markdown("---")
st.markdown("Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î³Î¹Î± ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿ÏÏ‚ ÏƒÎºÎ¿Ï€Î¿ÏÏ‚ ğŸŒ")
